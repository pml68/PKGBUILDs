pkgname=refilc-git
pkgver=4.5.2
pkgrel=1
pkgdesc="Nem hivatalos e-napló alkalmazás az e-KRÉTA rendszerhez - tanulóktól, tanulóknak."
arch=('x86_64')
url="https://github.com/refilc/naplo"
options=(!debug strip)
license=('AGPL-3.0')
makedepends=(
  'flutter'
  'git'
  'unzip'
)
source=(
  "git+https://github.com/pml68/naplo.git"
  "git+https://github.com/pml68/naplo-plus.git"
  "Makefile"
)
sha256sums=(
  'SKIP'
  'SKIP'
  'SKIP'
)

package() {
  cd "$srcdir/naplo"
  git submodule init
  git submodule set-url filcnaplo_premium "$srcdir/naplo-plus"
  git -c protocol.file.allow=always submodule update
  bash fix-pub.sh
	cd filcnaplo
	flutter create --platforms=linux .
	flutter build linux --release --dart-define=APPVER=$(cat pubspec.yaml | grep "version:" | cut -d' ' -f2 | cut -d+ -f1)
  mkdir -p $pkgdir/usr/bin
	install -Dm755 "$srcdir/naplo/filcnaplo/build/linux/x64/release/bundle/filcnaplo" "$pkgdir/usr/bin"
	cp -rf "$srcdir/naplo/filcnaplo/build/linux/x64/release/bundle/lib" "$pkgdir/usr/bin"
	cp -rf "$srcdir/naplo/filcnaplo/build/linux/x64/release/bundle/data" "$pkgdir/usr/bin"
}
